<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Exceptions - Pony Tutorial</title>
      
      
      
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="Pony Tutorial">
    <meta property="og:image" content="None/../../">
    <meta name="apple-mobile-web-app-title" content="Pony Tutorial">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-20d5debb47.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../../css/highlight.css">
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Expressions <i class="icon icon-link"></i>
              
            
          </span>
        
        Exceptions
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="/" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>Pony Tutorial </strong>
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
      <div class="toc">
        <ul>
          
            
  <li>
    <span class="section">Getting started</span>
    <ul>
      
        
  <li>
    <a class="" title="Welcome!" href="../..">
      Welcome!
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="What you need to start" href="../../getting-started/what-you-need-to-start/">
      What you need to start
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Installation" href="../../getting-started/installation/">
      Installation
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Helloworld" href="../../getting-started/helloworld/">
      Helloworld
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="How it works" href="../../getting-started/how-it-works/">
      How it works
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Whitespace" href="../../getting-started/whitespace/">
      Whitespace
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Types</span>
    <ul>
      
        
  <li>
    <a class="" title="Static vs dynamic" href="../../types/static-vs-dynamic/">
      Static vs dynamic
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Classes" href="../../types/classes/">
      Classes
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Primitives" href="../../types/primitives/">
      Primitives
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Actors" href="../../types/actors/">
      Actors
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Traits and interfaces" href="../../types/traits-and-interfaces/">
      Traits and interfaces
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Type aliases" href="../../types/type-aliases/">
      Type aliases
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Type expressions" href="../../types/type-expressions/">
      Type expressions
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Delegates" href="../../types/delegates/">
      Delegates
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Expressions</span>
    <ul>
      
        
  <li>
    <a class="" title="Variables" href="../variables/">
      Variables
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Infix ops" href="../infix-ops/">
      Infix ops
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Control structures" href="../control-structures/">
      Control structures
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Methods" href="../methods/">
      Methods
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="Exceptions" href="./">
      Exceptions
    </a>
    
      
        
      
      
    
  </li>

      
        
  <li>
    <a class="" title="Sugar" href="../sugar/">
      Sugar
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Object literals" href="../object-literals/">
      Object literals
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Partial application" href="../partial-application/">
      Partial application
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Capabilities</span>
    <ul>
      
        
  <li>
    <a class="" title="Object capabilities" href="../../capabilities/object-capabilities/">
      Object capabilities
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Reference capabilities" href="../../capabilities/reference-capabilities/">
      Reference capabilities
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Guarantees" href="../../capabilities/guarantees/">
      Guarantees
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Aliasing" href="../../capabilities/aliasing/">
      Aliasing
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Consume and destructive read" href="../../capabilities/consume-and-destructive-read/">
      Consume and destructive read
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Recovering capabilities" href="../../capabilities/recovering-capabilities/">
      Recovering capabilities
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Combining capabilities" href="../../capabilities/combining-capabilities/">
      Combining capabilities
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Passing and sharing" href="../../capabilities/passing-and-sharing/">
      Passing and sharing
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Capability subtyping" href="../../capabilities/capability-subtyping/">
      Capability subtyping
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Arrow types" href="../../capabilities/arrow-types/">
      Arrow types
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Trust boundary" href="../../capabilities/trust-boundary/">
      Trust boundary
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Generics</span>
    <ul>
      
        
  <li>
    <a class="" title="Polymorphic types" href="../../generics/polymorphic-types/">
      Polymorphic types
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Polymorphic methods" href="../../generics/polymorphic-methods/">
      Polymorphic methods
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Code sharing" href="../../composition-inheritance/code-sharing/">
      Code sharing
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Pattern Matching</span>
    <ul>
      
        
  <li>
    <a class="" title="Match" href="../../pattern-matching/match/">
      Match
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="As" href="../../pattern-matching/as/">
      As
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Packages</span>
    <ul>
      
        
  <li>
    <a class="" title="Package system" href="../../packages/package-system/">
      Package system
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Use statement" href="../../packages/use-statement/">
      Use statement
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Builtin" href="../../packages/builtin/">
      Builtin
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Use conditions" href="../../packages/platform/">
      Use conditions
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Compiler args" href="../../compiler-clargs/clargs/">
      Compiler args
    </a>
    
  </li>

          
            
  <li>
    <span class="section">C FFI</span>
    <ul>
      
        
  <li>
    <a class="" title="Calling C" href="../../c-ffi/calling-c/">
      Calling C
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Linking to C Libraries" href="../../c-ffi/linking-c/">
      Linking to C Libraries
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="C abi" href="../../c-ffi/c-abi/">
      C abi
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">The Runtime</span>
    <ul>
      
        
  <li>
    <a class="" title="Otp" href="../../runtime/otp/">
      Otp
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Memory allocation" href="../../runtime/memory-allocation/">
      Memory allocation
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Garbage collection" href="../../runtime/garbage-collection/">
      Garbage collection
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Examples" href="../../examples/examples/">
      Examples
    </a>
    
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <p>Pony provides a simple exception mechanism to aid error handling. At any point the code may decide to declare an <code>error</code> has occured. Code execution halts at that point and the call chain is unwound until the nearest enclosing error handler is found. This is all checked at compile time so errors cannot cause the whole program to crash.</p>
<h1 id="raising-and-handling-errors">Raising and handling errors</h1>
<p>An error is raised with the command <code>error</code>. Error handlers are declared using the try-else syntax.</p>
<pre><code class="pony">try
  callA()
  if not callB() then error end
  callC()
else
  callD()
end
</code></pre>

<p>In the above code callA() will always be executed and so will callB(). If the result of callB() is true then we will proceed to callC() in the normal fashion and callD() will not then be executed.</p>
<p>However, if callB() returns false, then an error will be raised. At this point execution will stop and the nearest enclosing error handler will be found and executed. In this example that is our else block and so callD() will be executed.</p>
<p>In either case execution will then carry on with whatever code comes after the try <code>end</code>.</p>
<p><strong>Do I have to provide an error handler?</strong> No. The try block will handle any errors regardless. If you don't provide an error handler then no error handling action will be taken - execution will simply continue after the try expression.</p>
<p>If you want to do something that might raise an error, but you don't care if it does you can just put in it a try block without an else.</p>
<pre><code class="pony">try
  call() // May raise an error
end
</code></pre>

<p><strong>Is there anything my error handler has to do?</strong> No. If you provide an error handler then it must contain some code, but it is entirely up to you what it does.</p>
<h1 id="partial-functions">Partial functions</h1>
<p>Pony does not require that all errors are handled immediately as in our previous examples. Instead functions can raise errors that are handled by whatever code calls them. These are called partial functions (this is a mathematical term meaning a function that does not have a defined result for all possible inputs, i.e. arguments). Partial functions <strong>must</strong> be marked as such in Pony with a <code>?</code>.</p>
<pre><code class="pony">fun factorial(x: I32): I32 ? =&gt;
  if x &lt; 0 then error end
  if x == 0 then
    1
  else
    x * factorial(x - 1)
  end
</code></pre>

<p>Everywhere that an error can be generated in Pony (an error command, a call to a partial function or certain built-in language constructs) must appear within a try block or a function that is marked as partial. This is checked at compile time, ensuring that an error cannot escape handling and crash the program.</p>
<h1 id="partial-constructors-and-behaviours">Partial constructors and behaviours</h1>
<p>Constructors may also be marked as partial. If a constructor raises an error then the construction is considered to have failed and the object under construction is discarded without ever being returned to the caller.</p>
<p>When an actor constructor is called the actor is created and a reference to it is returned immediately. However the constructor code is executed asynchronously at some later time. If an actor constructor were to raise an error it would already be too late to report this to the caller. For this reason constructors for actors may not be partial.</p>
<p>Behaviours are also executed asynchronously and so cannot be partial for the same reason.</p>
<h1 id="try-then-blocks">Try-then blocks</h1>
<p>In addition to an <code>else</code> error handler a try command can have a <code>then</code> block. This is executed after the rest of the try, whether or not an error is raised or handled. Expanding our example from earlier:</p>
<pre><code class="pony">try
  callA()
  if not callB() then error end
  callC()
else
  callD()
then
  callE()
end
</code></pre>

<p>The callE() will always be excuted. If callB() returns true then the sequence executed is callA(), callB(), callC(), callE(). If callB() returns false then the sequence executed is callA(), callB(), callD(), callE().</p>
<p><strong>Do I have to have an else error handler to have a then block?</strong> No. You can have a try-then block without an else if you like.</p>
<p><strong>Will my then block really always be executed, even if I return inside the try?</strong> Yes, your <code>then</code> expression will <strong>always</strong> be executed when the try block is complete. The only way it won't be is if the try never completes (due to an infinite loop), the machine is powered off or the process is killed (and then, maybe).</p>
<h1 id="with-blocks">With blocks</h1>
<p>A <code>with</code> expression can be used to ensure disposal of an object when it is no longer needed. A common case is a database connection which needs to be closed after use to avoid resource leaks on the server. For example:</p>
<pre><code class="pony">with obj = SomeObjectThatNeedsDisposing() do
  // use obj
end
</code></pre>

<p><code>obj.dispose()</code> will be called whether the code inside the <code>with</code> block completes successfully or raises an error. To take part in a <code>with</code> expression, the object that needs resource clean-up must therefore provide a <code>dispose()</code> method:</p>
<pre><code class="pony">class SomeObjectThatNeedsDisposing
  // constructor, other functions

  fun dispose() =&gt;
    // release resources
</code></pre>

<p>It is possible to provide an <code>else</code> clause, which is called only in error cases:</p>
<pre><code class="pony">with obj = SomeObjectThatNeedsDisposing() do
  // use obj
else
  // only run if an error has occurred
end
</code></pre>

<p>Multiple objects can be set up for disposal:</p>
<pre><code class="pony">with obj = SomeObjectThatNeedsDisposing(), other = SomeOtherDisposableObject() do
  // use obj
end
</code></pre>

<p>The value of a <code>with</code> expression is the value of the last expression in the block, or of the last expression in the <code>else</code> block, if there is one and an error occurred.</p>
<h1 id="language-constructs-that-can-raise-errors">Language constructs that can raise errors</h1>
<p>The only language construct that can raise an error, other than the error command or calling a partial method, is the <code>as</code> command. This converts the given value to the specified type, if it can be. If it can't then an error is raised. This means that the <code>as</code> command can only be used inside a try block or a partial method.</p>
<h1 id="comparison-to-exceptions-in-other-languages">Comparison to exceptions in other languages</h1>
<p>Pony exceptions behave very much the same as those in C++, Java, C#, Python and Ruby. The key difference is that Pony exceptions do not have a type or instance associated with them. This makes them the same as C++ exceptions would be if a fixed literal was always thrown, eg <code>throw 3;</code>. This difference simplifies exception handling for the programmer and allows for much better runtime error handling performance.</p>
<p>The <code>else</code> handler in a <code>try</code> expression is just like a <code>catch(...)</code> in C++, <code>catch(Exception e)</code> in Java or C#, <code>except:</code> in Python or <code>rescue</code> in Ruby. Since exceptions do not have types there is no need for handlers to specify types or to have multiple handlers in a single try block.</p>
<p>The <code>then</code> block in a <code>try</code> expression is just like a <code>finally</code> in Java, C# or Python and <code>ensure</code> in Ruby.</p>
<p>If required, error handlers can "reraise" by using the <code>error</code> command within the handler.</p>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../methods/" title="Methods">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Methods
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../sugar/" title="Sugar">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Sugar
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = '';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
      <script src="../../js/highlight.pack.js"></script>
    
    
  </body>
</html>